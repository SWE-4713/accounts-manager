<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Account List</title>
    <style>
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #ccc;
            padding: 10px;
        }
        .nav-buttons a {
            margin-right: 10px;
        }
        table {
            border-collapse: collapse;
            width: 90%;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .disabled-button {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
        }
    </style>
    <!-- Include any JavaScript libraries or CSS as needed for an enhanced calendar -->
</head>
<body>
    <!-- Header with logo, username, calendar and navigation buttons -->
    <header>
        <div>
            <img src="https://i.imgur.com/aBKRRy2.png" alt="Software Logo" style="height:50px;"/>
        </div>
        <div>
            <span th:text="'Welcome, ' + ${username}">Welcome, User</span>
        </div>
        <div>
            <input type="date" id="popupCalendar" />
        </div>
        <div class="nav-buttons">
            <a th:href="@{/accounts}" >Chart of Accounts</a>
            <a th:href="@{/journal}" >Journal</a>
            <a th:href="@{/event-logs}" >Event Logs</a>
        </div>
    </header>
    
    <h1>Chart of Accounts</h1>
    
    <!-- Search/Filter Form -->
    <form method="get" th:action="@{/accounts}">
        <input type="text" name="query" placeholder="Search by account name, number, category, subcategory, etc." 
               th:value="${param.query}" />
        <button type="submit">Search</button>
    </form>
    
    <a th:href="@{/accounts/add}">Add New Account</a>
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Account Name</th>
                <th>Account Number</th>
                <th>Description</th>
                <th>Normal Side</th>
                <th>Category</th>
                <th>Subcategory</th>
                <th>Initial Balance</th>
                <th>Debit</th>
                <th>Credit</th>
                <th>Balance</th>
                <th>Date Added</th>
                <th>User ID</th>
                <th>Order</th>
                <th>Statement</th>
                <th>Comment</th>
                <th>Active</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="account : ${accounts}">
                <td th:text="${account.id}"></td>
                <!-- Account name is now a link to the ledger view -->
                <td>
                    <a th:href="@{'/accounts/' + ${account.id} + '/ledger'}"
                       th:text="${account.accountName}"></a>
                </td>
                <td th:text="${account.accountNumber}"></td>
                <td th:text="${account.accountDescription}"></td>
                <td th:text="${account.normalSide}"></td>
                <td th:text="${account.accountCategory}"></td>
                <td th:text="${account.accountSubcategory}"></td>
                <td th:text="${#numbers.formatDecimal(account.initialBalance, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(account.debit, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(account.credit, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(account.balance, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${account.dateAdded}"></td>
                <td th:text="${account.userId}"></td>
                <td th:text="${account.accountOrder}"></td>
                <td th:text="${account.statement}"></td>
                <td th:text="${account.comment}"></td>
                <td th:text="${account.active}"></td>
                <td>
                    <a th:href="@{/accounts/edit(id=${account.id})}">Edit</a>
                    <!-- Only allow deactivation if balance equals zero -->
                    <form th:action="@{/accounts/deactivate}" method="post" style="display:inline;">
                        <input type="hidden" name="id" th:value="${account.id}" />
                        <button type="submit" 
                                th:if="${account.balance.compareTo(0) == 0}"
                                onclick="return confirm('Are you sure you want to deactivate this account?');">
                            Deactivate
                        </button>
                        <button type="button" 
                                th:if="${account.balance.compareTo(0) > 0}" 
                                class="disabled-button" 
                                title="Accounts with balance greater than zero cannot be deactivated."
                                disabled>
                            Deactivate
                        </button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>
