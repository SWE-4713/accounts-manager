<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Statement of Retained Earnings</title>
    <style>
        /* Basic styles (keep existing) */
        body { font-family: sans-serif; }
        .container{width:90%;margin:0 auto;}
        .report-box{background:#fff;padding:25px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05);}
        h1{margin:0 0 5px; text-align: center;}
        h3.report-date { text-align: center; margin-bottom: 20px; font-weight: normal;}
        .date-box{margin-bottom:15px; text-align: center;}
        .btn-green{background:#28a745;color:#fff;padding:8px 15px;border:none;border-radius:4px;cursor:pointer; margin-left: 10px;}
        .tab-btn{background:#007bff;color:#fff;border:none;padding:6px 12px;border-radius:4px;margin-right: 5px; margin-bottom:15px; cursor: pointer;}
        .tab-btn.active { background-color: #0056b3; font-weight: bold; }
        #snapshotButtons { text-align: center; margin-bottom: 15px; }

        /* Table styles (adjust as needed) */
        table { border-collapse: collapse; width: 100%; max-width: 600px; margin: 20px auto; }
        th, td { border: none; padding: 6px 8px; } /* Remove borders */
        .label-col { width: 70%; text-align: left; }
        .amount-col { width: 30%; text-align: right; }
        .indent-1 { padding-left: 20px; }
        .total-row td { border-top: 1px solid #000; }
        .final-total-row td { border-top: 1px solid #000; border-bottom: 3px double #000; font-weight: bold; }

        /* --- NEW STYLES --- */
        /* Deep green for positive/additions */
        .text-green { color: #006400; /* Slightly deep green */ }
        /* Deep red for negative/subtractions */
        .text-red { color: #8B0000; /* Slightly deep red */ }
        /* Ensure dollar sign stays inline */
        .dollar-sign { padding-right: 2px; display: inline !important; }
    </style>
</head>
<body>
<header th:replace="fragments/navbar :: navbar"></header>
<div class="container">
    <div class="report-box">
        <h1>Statement of Retained Earnings</h1>
        <h3 class="report-date" th:if="${startDate != null and endDate != null}" th:text="'For the period ' + ${#temporals.format(startDate, 'MM/dd/yyyy')} + ' to ' + ${#temporals.format(endDate, 'MM/dd/yyyy')}"></h3>
        <h3 class="report-date" th:if="${startDate == null and snapshotId != null}" th:text="${snapshotDateLabel}"></h3>

        <form th:action="@{/reports/retained-earning}" method="get" class="date-box">
            Start Date: <input type="date" name="startDate" th:value="${startDate != null ? #temporals.format(startDate, 'yyyy-MM-dd') : ''}" required>
            End Date:   <input type="date" name="endDate" th:value="${endDate != null ? #temporals.format(endDate, 'yyyy-MM-dd') : ''}" required>
            <button type="submit" class="btn-green">Generate Report</button>
        </form>

        <div id="snapshotButtons" th:if="${snapshots}">
            <button th:each="s: ${snapshots}" class="tab-btn"
                    th:classappend="${s.id == snapshotId} ? 'active' : ''"
                    th:onclick="'window.location.href=\'' + @{/reports/retained-earning(snapshotId=${s.id})} + '\''"
                    th:text="${s.text}">
            </button>
        </div>

        <div id="reportDisplay" th:if="${report != null}">
            <table>
                <tbody>
                    <tr>
                        <td class="label-col">Retained Earnings, Beginning</td>
                        <td class="amount-col">
                             <span class="dollar-sign">$</span>
                             <span th:text="${report.beginningBalance.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(report.beginningBalance.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${report.beginningBalance.signum() < 0 ? ')' : ''}"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-col indent-1" th:classappend="${report.netIncome != null and report.netIncome.signum() >= 0 ? 'text-green' : 'text-red'}">Add: Net Income</td>
                        <td class="amount-col" th:classappend="${report.netIncome != null and report.netIncome.signum() >= 0 ? 'text-green' : 'text-red'}">
                            <span th:if="${report.netIncome != null}">
                                <span class="dollar-sign">$</span>
                                <span th:text="${report.netIncome.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(report.netIncome.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${report.netIncome.signum() < 0 ? ')' : ''}"></span>
                            </span>
                        </td>
                    </tr>
                     <tr class="total-row">
                         <td class="label-col indent-1 text-red">Less: Dividends</td>
                        <td class="amount-col text-red">
                             <span th:if="${report.dividends != null}">
                                <span class="dollar-sign">$</span>
                                <span th:text="${report.dividends.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(report.dividends.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${report.dividends.signum() < 0 ? ')' : ''}"></span>
                            </span>
                        </td>
                    </tr>
                    <tr class="final-total-row">
                        <td class="label-col" th:classappend="${report.endingBalance != null and report.endingBalance.signum() >= 0 ? 'text-green' : 'text-red'}">Retained Earnings, Ending</td>
                        <td class="amount-col" th:classappend="${report.endingBalance != null and report.endingBalance.signum() >= 0 ? 'text-green' : 'text-red'}">
                            <span th:if="${report.endingBalance != null}">
                                <span class="dollar-sign">$</span>
                                <span th:text="${report.endingBalance.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(report.endingBalance.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${report.endingBalance.signum() < 0 ? ')' : ''}"></span>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
         <div th:unless="${report != null}" style="margin-top: 20px;">
            <p>Please select a date range and click "Generate Report" or choose a saved report.</p>
        </div>
    </div>
</div>
</body>
</html>