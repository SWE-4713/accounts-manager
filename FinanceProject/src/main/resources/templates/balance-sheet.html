<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Balance Sheet</title>
  <style>
    body { font-family: sans-serif; } /* Basic font */
    .container{width:90%;margin:0 auto;}
    .report-box{background:#fff;padding:25px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05);}
    h1{margin:0 0 5px; text-align: center;}
    h3.report-date { text-align: center; margin-bottom: 20px; font-weight: normal;} /* Centered date */
    .date-box{margin-bottom:15px; text-align: center;}
    .btn-green{background:#28a745;color:#fff;padding:8px 15px;border:none;border-radius:4px;cursor:pointer; margin-left: 10px;}
    .tab-btn{background:#007bff;color:#fff;border:none;padding:6px 12px;border-radius:4px;margin-right: 5px; margin-bottom:15px; cursor: pointer;}
    .tab-btn.active { background-color: #0056b3; font-weight: bold; }
    #snapshotButtons { text-align: center; margin-bottom: 15px; } /* Center snapshot buttons */

    table{border-collapse:collapse;width:100%; max-width: 700px; margin: 0 auto;} /* Center table */
    table, th, td{border:none!important;}
    td{padding: 4px 8px; vertical-align: top;} /* Adjust padding */

    /* Layout specific styles */
    td.label-col {
        width: 70%;
        text-align: left; /* Ensure left alignment */
        padding-left: 0;
    }
    td.amount-col1, td.amount-col2 {
        width: 15%;
        text-align: right; /* Ensure right alignment */
    }
    /* Ensure dollar sign stays inline */
    .dollar-sign { padding-right: 2px; display: inline !important; } /* Keep this */

    /* Styling based on styleClass applied to TR */
    tr.section-header td.label-col { font-weight: bold; font-size: 1.1em; padding-top: 15px; }
    tr.subheader td.label-col { font-weight: bold; }
    tr.total td { font-weight: bold; }
    tr.subtotal td { font-weight: bold; }

    /* Indentation applied via padding on the label column based on TR class */
    tr.indent-1 td.label-col { padding-left: 15px !important; }
    tr.indent-2 td.label-col { padding-left: 30px !important; }
    tr.indent-3 td.label-col { padding-left: 45px !important; }

    /* Underlines applied via borders on TR */
    tr.underline td { border-top: 1px solid #000; }
    tr.double-underline td { border-bottom: 3px double #000; padding-bottom: 2px;} /* Double underline for final totals */
    tr.blank-row td { padding-top: 10px; padding-bottom: 10px; }
    tr.error td { color: red; font-weight: bold; } /* Style for error messages */
  </style>
</head>
<body>
  <header th:replace="fragments/navbar :: navbar"></header>
    <div class="container">
      <div class="report-box">
        <h1>Balance Sheet</h1>
        <h3 class="report-date" th:if="${date != null}" th:text="'As of ' + ${#temporals.format(date, 'MM/dd/yyyy')}"></h3>
        <h3 class="report-date" th:if="${date == null and snapshotId != null}" th:text="${snapshotDateLabel}"></h3>

        <form th:action="@{/reports/balance-sheet}" method="get" class="date-box">
            As of: <input type="date" name="date" th:value="${date != null ? #temporals.format(date, 'yyyy-MM-dd') : ''}" required>
            <button type="submit" class="btn-green" id="generateReportBtn">Generate Report</button>
        </form>

          <div id="snapshotButtons" th:if="${snapshots}">
            <button th:each="s: ${snapshots}" class="tab-btn"
                    th:classappend="${s.id == snapshotId} ? 'active' : ''"
                    th:onclick="'window.location.href=\'' + @{/reports/balance-sheet(snapshotId=${s.id})} + '\''"
                    th:text="${s.text}">
            </button>
          </div>

          <div id="reportDisplay" th:if="${rows != null and not #lists.isEmpty(rows)}">
            <table>
                <tbody>
                    <tr th:each="row : ${rows}" th:classappend="${row.styleClass}">

                         <td class="label-col" th:text="${row.label}"></td>

                         <td class="amount-col1">
                             <span th:if="${row.displayColumn == 1 and row.amount != null}">
                                 <span th:if="${row.label == 'Total Current Assets' or row.label == 'Total Assets' or row.label == 'Total Stockholders Equity' or row.label == 'Total Liabilities & Stockholders Equity'}">
                                     $<span th:text="${row.amount.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(row.amount.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${row.amount.signum() < 0 ? ')' : ''}"></span>
                                 </span>
                                 <span th:unless="${row.label == 'Total Current Assets' or row.label == 'Total Assets' or row.label == 'Total Stockholders Equity' or row.label == 'Total Liabilities & Stockholders Equity'}">
                                     <span class="dollar-sign" th:if="${row.showDollarSign}">$</span>
                                     <span th:text="${row.amount.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(row.amount.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${row.amount.signum() < 0 ? ')' : ''}"></span>
                                 </span>
                             </span>
                         </td>

                         <td class="amount-col2">
                             <span th:if="${row.displayColumn == 2 and row.amount != null}">
                                 <span th:if="${row.label == 'Total Current Assets' or row.label == 'Total Assets' or row.label == 'Total Stockholders Equity' or row.label == 'Total Liabilities & Stockholders Equity'}">
                                     $<span th:text="${row.amount.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(row.amount.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${row.amount.signum() < 0 ? ')' : ''}"></span>
                                 </span>
                                 <span th:unless="${row.label == 'Total Current Assets' or row.label == 'Total Assets' or row.label == 'Total Stockholders Equity' or row.label == 'Total Liabilities & Stockholders Equity'}">
                                      <span class="dollar-sign" th:if="${row.showDollarSign}">$</span>
                                     <span th:text="${row.amount.signum() < 0 ? '(' : ''}"></span><span th:text="${#numbers.formatDecimal(row.amount.abs(), 1, 'COMMA', 2, 'POINT')}"></span><span th:text="${row.amount.signum() < 0 ? ')' : ''}"></span>
                                 </span>
                             </span>
                         </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div th:unless="${rows != null and not #lists.isEmpty(rows)}" style="margin-top: 20px;">
            <p>Please select a date and click "Generate Report" or choose a saved report.</p>
        </div>
      </div>
    </div>
  </body>
</html>